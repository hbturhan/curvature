<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset='utf-8'>
    <link rel="stylesheet" type="text/css" href="css/app.css">
    <link rel="shortcut icon" type="image/png" href="images/favicon.png">
    <title>Earth Curvature Calculator</title>
    <style>
      @import 'https://fonts.googleapis.com/css?family=Raleway:300,700';
    </style>
  </head>
  <body>
    <div class="content">
      <div class="header">
        <h1>Earth Curvature Calculator</h1>
        <p class="link">
          by <a href="http://www.nyttnorge.com">NyttNorge.com</a>
        </p>
        <p class="intro">
          Accurately calculate the curvature you are supposed to see on the ball Earth.
        </p>
      </div>

      <div class="frame">
        <div class="distance">
          <label>
            Distance:
            <input id="distance" type="number" value="20">
          </label>

          <span class="unit">
            <select id="unit" name="unit">
              <option value="km">
                Kilometers
              </option>
              <option value="miles">
                Miles
              </option>
            </select>
          </span>

          <span class="calculate">
            <button onclick="calc()">Calculate</button>
          </span>
        </div>

        <div class="result"></div>
      </div>

      <div class="explain">
        <h2>Explanation:</h2>
        <div class="formula">
          <p>
            The Earth's radius <code class="light">(r)</code> is 6371 km or 3959 miles, which gives a circumference <code class="light">(c)</code>of<br>
            <code>c = 2 * &pi; * r = 40 030 km</code> based on numbers from <a href="https://en.wikipedia.org/wiki/Earth_radius" target="_blank">Wikipedia</a>
          </p>
          <p>
            We wish to find the height <code class="light">(h)</code> which is the drop in curvature over the distance <code class="light">(d)</code>
          </p>
          <p>
            Using the circumference we find that 1 unit of distance (km or mile) has the angle<br><code>360&deg; / 40030 km = 0.009&deg;</code>. The angle <code class="light">(a)</code> is then <code>a = 0.009 * distance (d)</code>
          <p>
          <p>
            The derived formula <code>h = r * (1 - cos a)</code> is accurate for any distance <code class="light">(d)</code>
          </p>
        </div>
        <div class="image">
          <img src="images/earth_curvature_calculator_formula.png" alt="curvature" style="width:333px;height:333px;">
        </div>
      </div>
      <div class="footer">
        <p>
          <a href="https://github.com/suongp/curvature">Source code</a>
        </p>
        <p class="hint">
          Note: Using the formula <em>8 times the distance in miles squared</em>, <a target="_blank" href="https://dizzib.github.io/earth/curve-calc">like here,</a> is not accurate for long distances but are fine for practical use.
        </p>
      </div>
    </div>

    <script>

      var distance = document.querySelector("#distance")
        , unit = document.querySelector("#unit")
        , result = document.querySelector(".result")
        , d, r, c, g, e, a, h, m, n, debug = true;

      function calc (){
        d = distance.value;

        if(d.length < 1) {
          distance.focus();
          return false;
        }

        // Convert to number
        d = parseFloat(d);

        if(debug) console.log("D: "+ d);

        // Earth's radius in kilometers
        r = 6371;

        // Convert to miles if miles is selected
        if(unit.value == 'miles') {
          r = r / 1.609344;
        }

        if(debug) console.log("R: "+ r);

        // Find the circumference
        c = 2 * Math.PI * r;

        if(debug) console.log("C: "+ c);

        // Find degrees per 1 unit (1 km or 1 mile)
        g = 360 / c;

        if(debug) console.log("G: "+ g);

        // Unit degrees times distance
        e = g * d;

        if(debug) console.log("E: "+ e);

        // Convert degrees to radians since javascript likes that
        a = e * (Math.PI / 180);

        if(debug) console.log("A: "+ a);

        h = r * (1 - Math.cos(a));

        if(debug) console.log("H: "+ h);

        // Not in use. Keeping it for later.
        if(false) {
          result.innerHTML = "<div class='error'>Number is too high, please try a lower number.</div>";
          return false;
        }

        // Limit decimals based on value
        if(h > 1000) {
          n = 2;
        } else if(h > 100) {
          n = 3;
        } else if(h > 10) {
          n = 4;
        } else {
          n = 5;
        }

        // Set large value
        m = h.toFixed(n);

        if(unit.value == 'miles') {
          h = m + " miles <span class='or'>=</span> " + (h * 5280).toFixed(2) + " feet";
        } else {
          h = m + " km <span class='or'>=</span> " + (h * 1000).toFixed(2) + " meters";
        }

        // Write result as HTML into result element
        result.innerHTML = '<div class="highlight">' + h + '</div>';
      }

    </script>
  </body>
</html>
