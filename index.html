<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset='utf-8'>
    <link rel="stylesheet" type="text/css" href="css/app.css">
    <link rel="shortcut icon" type="image/png" href="images/favicon.png">
    <title>Earth Curvature Calculator</title>
  </head>
  <body>
    <div class="content">
      <div class="header">
        <h1>Earth Curvature Calculator</h1>
        <p>
          Use this calculator to calculate the curvature you should be seeing on the earth.
        </p>
      </div>

      <div class="distance">
        <label>
          Distance:
          <input id="distance" type="number" value="20">
        </label>

        <span class="unit">
          <select id="unit" name="unit">
            <option value="km">
              Kilometers
            </option>
            <option value="miles">
              Miles
            </option>
          </select>
        </span>

        <span class="calculate">
          <button onclick="calc()">Calculate</button>
        </span>
      </div>

      <div class="result"></div>

      <div class="explain">
        <h3>Explanation:</h3>
        <div class="formula">
          <p>
            The Earth's radius (r) is 6371 km or 3959 miles based on
            <a href="https://en.wikipedia.org/wiki/Earth_radius" target="_blank">Wikipedia</a>
          </p>
          <p>
            Pythagora's formula states that <code>r&sup2; + b&sup2; = c&sup2;</code>
          </p>
          <p>
            Therefore <code>c = &radic;<span style="text-decoration: overline">&nbsp;b&sup2; + r&sup2;&nbsp;</span></code>
          </p>
          <p>
            We wish to find the height of the curvature (h) between two points on the Earth, which is the viewing distance divided by 2 (b).
          </p>
          <p>
            The height (h) is c - r (the radius of the Earth).
          <p>
            Subsituting for b we get the formula <code>h = &radic;<span style="text-decoration: overline">&nbsp;(d/2)&sup2; + r&sup2;&nbsp;</span> &ndash; r</code>
          </p>
        </div>
        <div class="image">
          <img src="images/earth_curvature_calculator_formula.png" alt="curvature" style="width:333px;height:333px;">
        </div>
      </div>
      <div class="footer">
        <p>
          <a href="https://github.com/suongp/curvature">Source code</a>
        </p>
      </div>
    </div>

    <script>
      var debug = false;
      var distance = document.querySelector("#distance");
      var unit = document.querySelector("#unit");
      var result = document.querySelector(".result");

      function calc (){
        var val = distance.value;

        if(val.length < 1) {
          distance.focus();
          return false;
        }
        var b = parseFloat(val) / 2;
        if(debug) console.log("B: " + b);

        // Earth's radius in kilometers
        var r = 6371;

        // Convert to miles if miles is selected
        if(unit.value == 'miles') {
          r = r / 1.609344;
        }

        if(debug) console.log("R: " + r);

        var a2 = Math.pow(r, 2) - Math.pow(b, 2);
        if(debug) console.log("A2: " + a2);

        var a = Math.sqrt(a2);
        if(debug) console.log("A: " + a);

        var h = r - a;

        if(debug) console.log("H: "+ h);

        // Limit to 6 decimals
        h = h.toFixed(6);
        if(unit.value == 'miles') {
          h = h + " miles or " + (h * 5280).toFixed(2) + " feet";
        } else {
          h = h + " km or " + (h * 1000).toFixed(2) + " meters";
        }

        // Write result as HTML into result element
        result.innerHTML = h;
      }

    </script>
  </body>
</html>
